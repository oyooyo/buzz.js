(function(){"use strict";var t,e,s,i,r,n,h,d,o,a,l;r=class{constructor(){this.events={}}add_listener(t,e){return this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(e),this}remove_listener(t,e){var s,i;return this.events.hasOwnProperty(t)&&(s=(i=this.events[t]).indexOf(e))>=0&&i.splice(s,1),this}once(t,e){var s;return s=function(){return this.removeListener(t,s),e.apply(this,arguments)},this.add_listener(t,s),this}emit(t){var e,s,i,r;if(e=Array.prototype.slice.call(arguments,1),this.events.hasOwnProperty(t))for(s=0,i=(r=this.events[t].slice()).length;s<i;s++)r[s].apply(this,e);return this}on(){return this.add_listener.apply(this,arguments),this}fire(){return this.emit.apply(this,arguments),this}},h=function(t,e){return 0!=(e&1<<t)},n=function(t,e){return h(t%8,e[Math.floor(t/8)])},t=class extends r{constructor(t,e){super(),this.controller=t,this.index=e,this.id=`${this.controller.id}:${this.index}`,this.bit_index=20+5*this.controller.index-this.index,this.device=this.controller.device,this.device.on("changed_state",()=>{var t;this.changed_state()&&(t={button:this,controller:this.controller,device:this.device},this.emit("changed_state",t),this.is_pressed()?(this.emit("got_pressed",t),this.emit("press",t)):(this.emit("got_released",t),this.emit("release",t)))})}is_pressed(){return n(this.bit_index,this.device.state)}was_pressed(){return n(this.bit_index,this.device.last_state)}is_released(){return!this.is_pressed()}was_released(){return!this.was_pressed()}got_pressed(){return this.is_pressed()&&!this.was_pressed()}got_released(){return this.was_pressed()&&!this.is_pressed()}changed_state(){return this.is_pressed()!==this.was_pressed()}toString(){return`<Buzz Button ${this.id}>`}},s=class extends r{constructor(e,s){var i;super(),this.device=e,this.index=s,this.id=`${this.device.id}:${this.index}`,this.buttons=function(){var e,s;for(s=[],i=e=0;e<5;i=++e)s.push(new t(this,i));return s}.call(this),this.button={blue:this.buttons[0],orange:this.buttons[1],green:this.buttons[2],yellow:this.buttons[3],red:this.buttons[4],buzzer:this.buttons[4]},this.device.on("changed_state",()=>{var t,e,s;for(t=0,e=(s=this.buttons).length;t<e;t++)if(s[t].changed_state()){this.emit("changed_state",{controller:this,device:this.device});break}})}light_is_on(){return 0!==this.device.lights[1+this.index]}set_next_light(t){this.device.next_lights[1+this.index]=t?255:0}set_light(t){return this.set_next_light(t),this.device.output_next_lights()}toString(){return`<Buzz Controller ${this.id}>`}},d=function(t,e){var s,i,r;for(i=s=0,r=e.length;s<r;i=s+=1)t[i]=e[i]},o=function(t){var e,s,i,r;for(r=[],s=e=0,i=t.byteLength;0<=i?e<i:e>i;s=0<=i?++e:--e)r.push(t.getUint8(s));return r},i=class extends r{constructor(t,e){var i;super(),this.hid_device=t,this.index=e,this.id=`${this.index}`,this.lights=[],this.next_lights=[0,0,0,0,0,0,0],this.controllers=function(){var t,e;for(e=[],i=t=0;t<4;i=++t)e.push(new s(this,i));return e}.call(this)}output_next_lights(){return this.hid_device.sendReport(0,Uint8Array.from(this.next_lights)).then(()=>{d(this.lights,this.next_lights)})}initialize(){return this.state=[0,0,0,0,0],this.last_state=[0,0,0,0,0],this.hid_device.addEventListener("inputreport",t=>{d(this.last_state,this.state),d(this.state,o(t.data)),this.emit("changed_state",{device:this})}),this.output_next_lights()}toString(){return`<Buzz Device ${this.id}>`}},l=function(){return void 0!==navigator.hid},a=function(){return l()?Promise.resolve():Promise.reject("WebHID is not available")},e=class extends r{constructor(){super(),this.devices=[],this.controllers=[],this.open_device=(()=>a().then(()=>navigator.hid.requestDevice({filters:[{vendorId:1356,productId:4096}]}).then(t=>t.open().then(()=>{var e;return(e=new i(t,this.devices.length)).initialize().then(()=>{var t,s,i,r;for(e.on("changed_state",()=>{this.emit("changed_state",{device:e})}),this.devices.push(e),this.emit("device_added",{device:e}),s=0,i=(r=e.controllers).length;s<i;s++)t=r[s],this.controllers.push(t),this.emit("controller_added",{controller:t,device:e});return e})}))))}},window.buzz=new e}).call(this);
